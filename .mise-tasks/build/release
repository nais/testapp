#!/usr/bin/env sh
#MISE description="Build testapp for release"

set -e

DATE=$(date "+%Y-%m-%d")
LAST_COMMIT=$(git --no-pager log -1 --pretty=%h)
VERSION="${DATE}-${LAST_COMMIT}"
LDFLAGS="-X github.com/nais/testapp/pkg/version.Revision=$(git rev-parse --short HEAD) -X github.com/nais/testapp/pkg/version.Version=${VERSION} -s"

go build -a -installsuffix cgo -o bin/testapp -ldflags "${LDFLAGS}" ./cmd/testapp
